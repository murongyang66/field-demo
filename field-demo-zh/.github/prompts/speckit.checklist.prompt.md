---
description: 根据用户需求为当前功能生成自定义清单。
---

## 清单目的："需求文档的单元测试"

**关键概念**：清单是**需求文档的单元测试** - 它们验证给定领域中需求的质量、清晰度和完整性。

**不适用于验证/测试**：
- ❌ 不是"验证按钮点击正确" 
- ❌ 不是"测试错误处理有效"
- ❌ 不是"确认API返回200"
- ❌ 不是检查代码/实现是否符合规范

**适用于需求质量验证**：
- ✅ "是否为所有卡片类型定义了视觉层次要求？"（完整性）
- ✅ "'突出显示'是否用特定的大小/位置进行量化？"（清晰度）
- ✅ "所有交互元素的悬停状态要求是否一致？"（一致性）
- ✅ "是否为键盘导航定义了无障碍要求？"（覆盖范围）
- ✅ "规范是否定义了标志图片加载失败时的行为？"（边缘情况）

**比喻**：如果你的规范是用英文编写的代码，那么清单就是它的单元测试套件。你在测试需求是否写得好、完整、明确，并且已准备好实施 - 而不是测试实现是否有效。

## 用户输入

```text
$ARGUMENTS
```

在继续之前，你**必须**考虑用户输入（如果不为空）。

## 执行步骤

1. **设置**：从仓库根目录运行`.specify/scripts/powershell/check-prerequisites.ps1 -Json`并解析JSON以获取FEATURE_DIR和AVAILABLE_DOCS列表。
   - 所有文件路径必须是绝对路径。
   - 对于参数中的单引号，如"I'm Groot"，使用转义语法：例如'I'\''m Groot'（或尽可能使用双引号："I'm Groot"）。

2. **澄清意图（动态）**：最多派生三个初始上下文澄清问题（非预定义目录）。这些问题必须：
   - 从用户的措辞和从规范/计划/任务中提取的信号生成
   - 仅询问对清单内容有实质性变化的信息
   - 如果在`$ARGUMENTS`中已经明确，则单独跳过
   - 优先考虑精确性而不是广度

   生成算法：
   1. 提取信号：功能领域关键词（例如auth、延迟、UX、API）、风险指标（"critical"、"must"、"compliance"）、利益相关者提示（"QA"、"review"、"security team"）和明确的可交付成果（"a11y"、"rollback"、"contracts"）。
   2. 将信号聚类为候选重点领域（最多4个），按相关性排序。
   3. 如果不明确，识别可能的受众和时机（作者、审阅者、QA、发布）。
   4. 检测缺失维度：范围广度、深度/严格度、风险强调、排除边界、可衡量的验收标准。
   5. 从这些原型中制定问题：
      - 范围细化（例如，"这应该包括与X和Y的集成接触点，还是仅限于本地模块正确性？"）
      - 风险优先级（例如，"这些潜在风险领域中哪些应该接受强制性检查？"）
      - 深度校准（例如，"这是轻量级的提交前检查清单还是正式的发布关卡？"）
      - 受众框架（例如，"这仅由作者使用还是在PR审查期间由同行使用？"）
      - 边界排除（例如，"我们是否应该明确排除本轮的性能调优项目？"）
      - 场景类别差距（例如，"未检测到恢复流程—回滚/部分失败路径是否在范围内？"）

   问题格式规则：
   - 如果提供选项，生成带有列的紧凑表格：选项 | 候选 | 为何重要
   - 最多限制A-E选项；如果自由格式答案更清晰，则省略表格
   - 永远不要要求用户重述他们已经说过的内容
   - 避免推测性类别（无幻觉）。如果不确定，明确询问："确认X是否属于范围。"

   当无法交互时的默认值：
   - 深度：标准
   - 受众：如果与代码相关，则为审阅者（PR）；否则为作者
   - 重点：相关性最高的2个聚类

   输出问题（标记为Q1/Q2/Q3）。回答后：如果≥2个场景类别（替代/异常/恢复/非功能领域）仍然不明确，你可以最多再询问两个针对性的后续问题（Q4/Q5），每个问题附带一行说明（例如，"未解决的恢复路径风险"）。总问题数不要超过五个。如果用户明确拒绝更多问题，则跳过升级。

3. **理解用户请求**：结合`$ARGUMENTS`和澄清答案：
   - 派生清单主题（例如，安全、审查、部署、ux）
   - 整合用户提到的明确必须项
   - 将重点选择映射到类别支架
   - 从规范/计划/任务中推断任何缺失的上下文（不要臆测）

4. **加载功能上下文**：从FEATURE_DIR读取：
   - spec.md：功能需求和范围
   - plan.md（如果存在）：技术细节、依赖项
   - tasks.md（如果存在）：实施任务
   
   **上下文加载策略**：
   - 仅加载与活动重点领域相关的必要部分（避免完整文件转储）
   - 优先将长部分总结为简洁的场景/需求要点
   - 使用渐进式披露：仅在检测到差距时添加后续检索
   - 如果源文档很大，生成临时摘要项而不是嵌入原始文本

5. **生成清单** - 创建"需求的单元测试"：
   - 如果不存在，创建`FEATURE_DIR/checklists/`目录
   - 生成唯一的清单文件名：
     - 使用基于领域的简短、描述性名称（例如`ux.md`、`api.md`、`security.md`）
     - 格式：`[domain].md`
     - 如果文件存在，追加到现有文件
   - 项目从CHK001开始顺序编号
   - 每次`/speckit.checklist`运行创建一个新文件（从不覆盖现有清单）

   **核心原则 - 测试需求，而非实现**：
   每个清单项必须评估需求本身的：
   - **完整性**：是否存在所有必要的需求？
   - **清晰度**：需求是否明确和具体？
   - **一致性**：需求是否相互一致？
   - **可衡量性**：需求是否可以客观验证？
   - **覆盖范围**：是否涵盖所有场景/边缘情况？
   
   **类别结构** - 按需求质量维度分组项目：
   - **需求完整性**（是否记录了所有必要的需求？）
   - **需求清晰度**（需求是否具体和明确？）
   - **需求一致性**（需求是否一致无冲突？）
   - **验收标准质量**（成功标准是否可衡量？）
   - **场景覆盖**（是否涵盖所有流程/案例？）
   - **边缘情况覆盖**（是否定义了边界条件？）
   - **非功能需求**（性能、安全性、可访问性等 - 是否有明确规定？）
   - **依赖项和假设**（是否有记录和验证？）
   - **歧义与冲突**（需要澄清什么？）
   
   **如何编写清单项 - "需求文档的单元测试"**：

   ❌ **错误**（测试实现）：
   - "验证登陆页面显示3个剧集卡片"
   - "测试悬停状态在桌面端工作"
   - "确认标志点击导航到首页"
   
   ✅ **正确**（测试需求质量）：
   - "是否明确指定了精选剧集的确切数量和布局？"[完整性]
   - "'突出显示'是否用特定的大小/位置进行量化？"[清晰度]
   - "所有交互元素的悬停状态要求是否一致？"[一致性]
   - "是否为所有交互UI定义了键盘导航要求？"[覆盖范围]
   - "规范是否定义了标志图片加载失败时的回退行为？"[边缘情况]
   - "是否为异步剧集数据定义了加载状态？"[完整性]
   - "规范是否为相互竞争的UI元素定义了视觉层次？"[清晰度]
   
   **项目结构**：
   每个项目应遵循此模式：
   - 询问需求质量的问题格式
   - 关注规范/计划中**已写**（或未写）的内容
   - 在括号中包含质量维度[完整性/清晰度/一致性等]
   - 检查现有需求时引用规范部分`[Spec §X.Y]`
   - 检查缺失需求时使用`[Gap]`标记
   
   **按质量维度的示例**：

   完整性：
   - "是否为所有API失败模式定义了错误处理需求？[Gap]"
   - "是否为所有交互元素指定了无障碍要求？[完整性]"
   - "是否为响应式布局定义了移动断点要求？[Gap]"
   
   清晰度：
   - "'快速加载'是否用特定的时间阈值进行量化？[清晰度, Spec §NFR-2]"
   - "'相关剧集'的选择标准是否明确定义？[清晰度, Spec §FR-5]"
   - "'突出'是否用可测量的视觉属性定义？[歧义, Spec §FR-4]"
   
   一致性：
   - "所有页面的导航要求是否一致？[一致性, Spec §FR-10]"
   - "登陆页面和详情页面之间的卡片组件要求是否一致？[一致性]"
   
   覆盖范围：
   - "是否为零状态场景（无剧集）定义了需求？[覆盖范围, 边缘情况]"
   - "是否涵盖了并发用户交互场景？[覆盖范围, Gap]"
   - "是否为部分数据加载失败指定了需求？[覆盖范围, 异常流程]"
   
   可衡量性：
   - "视觉层次要求是否可测量/可测试？[验收标准, Spec §FR-1]"
   - "'平衡的视觉权重'是否可以客观验证？[可衡量性, Spec §FR-2]"

   **场景分类与覆盖**（需求质量焦点）：
   - 检查是否存在针对主要、替代、异常/错误、恢复、非功能场景的需求
   - 对于每个场景类，询问："[场景类型]需求是否完整、清晰和一致？"
   - 如果缺少场景类："[场景类型]需求是故意排除还是缺失？[Gap]"
   - 当发生状态变更时，包括弹性/回滚："是否为迁移失败定义了回滚需求？[Gap]"

   **可追溯性要求**：
   - 最低要求：≥80%的项目必须包含至少一个可追溯性引用
   - 每个项目应引用：规范部分`[Spec §X.Y]`，或使用标记：`[Gap]`，`[歧义]`，`[冲突]`，`[假设]`
   - 如果没有ID系统："是否建立了需求和验收标准ID方案？[可追溯性]"

   **发现并解决问题**（需求质量问题）：
   询问有关需求本身的问题：
   - 歧义："'快速'一词是否用特定指标量化？[歧义, Spec §NFR-1]"
   - 冲突："§FR-10和§FR-10a之间的导航要求是否冲突？[冲突]"
   - 假设："'始终可用的播客API'的假设是否得到验证？[假设]"
   - 依赖项："是否记录了外部播客API要求？[依赖项, Gap]"
   - 缺失定义："'视觉层次'是否用可测量的标准定义？[Gap]"

   **内容合并**：
   - 软上限：如果原始候选项目>40，按风险/影响进行优先级排序
   - 合并检查相同需求方面的近似重复项
   - 如果>5个低影响边缘情况，创建一个项目："边缘情况X、Y、Z是否在需求中得到解决？[覆盖范围]"

   **🚫 绝对禁止** - 这些使其成为实现测试，而非需求测试：
   - ❌ 任何以"验证"、"测试"、"确认"、"检查"+实现行为开头的项目
   - ❌ 引用代码执行、用户操作、系统行为
   - ❌ "正确显示"、"正常工作"、"按预期运行"
   - ❌ "点击"、"导航"、"渲染"、"加载"、"执行"
   - ❌ 测试用例、测试计划、QA程序
   - ❌ 实现细节（框架、API、算法）
   
   **✅ 必需模式** - 这些测试需求质量：
   - ✅ "是否为[场景]定义/指定/记录了[需求类型]？"
   - ✅ "[模糊术语]是否用特定标准量化/澄清？"
   - ✅ "[部分A]和[部分B]之间的需求是否一致？"
   - ✅ "[需求]是否可以客观测量/验证？"
   - ✅ "[边缘情况/场景]是否在需求中得到解决？"
   - ✅ "规范是否定义了[缺失方面]？"

6. **结构参考**：按照`.specify/templates/checklist-template.md`中的规范模板生成清单，包括标题、元部分、类别标题和ID格式。如果模板不可用，使用：H1标题、目的/创建元行、`##`类别部分包含`- [ ] CHK### <需求项>`行，全局递增ID从CHK001开始。

7. **报告**：输出创建的清单的完整路径、项目计数，并提醒用户每次运行都会创建一个新文件。总结：
   - 选择的重点领域
   - 深度级别
   - 角色/时机
   - 任何纳入的明确用户指定的必须项

**重要**：每次`/speckit.checklist`命令调用都使用简短、描述性的名称创建清单文件，除非文件已存在。这允许：

- 不同类型的多个清单（例如`ux.md`、`test.md`、`security.md`）
- 简单、易记的文件名，表明清单目的
- 在`checklists/`文件夹中易于识别和导航

为避免混乱，请使用描述性类型并在完成后清理过时的清单。

## 示例清单类型和样本项目

**UX需求质量**：`ux.md`

样本项目（测试需求，而非实现）：
- "视觉层次要求是否用可测量的标准定义？[清晰度, Spec §FR-1]"
- "UI元素的数量和位置是否明确指定？[完整性, Spec §FR-1]"
- "交互状态要求（悬停、聚焦、激活）是否一致定义？[一致性]"
- "是否为所有交互元素指定了无障碍要求？[覆盖范围, Gap]"
- "是否定义了图像加载失败时的回退行为？[边缘情况, Gap]"
- "'突出显示'是否可以客观测量？[可衡量性, Spec §FR-4]"

**API需求质量**：`api.md`

样本项目：
- "是否为所有失败场景指定了错误响应格式？[完整性]"
- "速率限制要求是否用特定阈值量化？[清晰度]"
- "所有端点的身份验证要求是否一致？[一致性]"
- "是否为外部依赖项定义了重试/超时要求？[覆盖范围, Gap]"
- "需求中是否记录了版本控制策略？[Gap]"

**性能需求质量**：`performance.md`

样本项目：
- "性能需求是否用特定指标量化？[清晰度]"
- "是否为所有关键用户旅程定义了性能目标？[覆盖范围]"
- "是否指定了不同负载条件下的性能需求？[完整性]"
- "性能需求是否可以客观测量？[可衡量性]"
- "是否为高负载场景定义了降级需求？[边缘情况, Gap]"

**安全需求质量**：`security.md`

样本项目：
- "是否为所有受保护资源指定了身份验证要求？[覆盖范围]"
- "是否为敏感信息定义了数据保护要求？[完整性]"
- "威胁模型是否记录并且需求与其一致？[可追溯性]"
- "安全需求是否与合规义务一致？[一致性]"
- "是否定义了安全失败/漏洞响应需求？[Gap, 异常流程]"

## 反例：不要做什么

**❌ 错误 - 这些测试实现，而非需求**：

```markdown
- [ ] CHK001 - 验证登陆页面显示3个剧集卡片 [Spec §FR-001]
- [ ] CHK002 - 测试悬停状态在桌面端正确工作 [Spec §FR-003]
- [ ] CHK003 - 确认标志点击导航到首页 [Spec §FR-010]
- [ ] CHK004 - 检查相关剧集部分显示3-5个项目 [Spec §FR-005]
```

**✅ 正确 - 这些测试需求质量**：

```markdown
- [ ] CHK001 - 精选剧集的数量和布局是否明确指定？[完整性, Spec §FR-001]
- [ ] CHK002 - 所有交互元素的悬停状态要求是否一致定义？[一致性, Spec §FR-003]
- [ ] CHK003 - 所有可点击品牌元素的导航要求是否清晰？[清晰度, Spec §FR-010]
- [ ] CHK004 - 相关剧集的选择标准是否有文档记录？[Gap, Spec §FR-005]
- [ ] CHK005 - 异步剧集数据的加载状态要求是否已定义？[Gap]
- [ ] CHK006 - "视觉层次"要求是否可以客观测量？[可衡量性, Spec §FR-001]
```

**关键区别**：
- 错误：测试系统是否正常工作
- 正确：测试需求是否写得正确
- 错误：行为验证
- 正确：需求质量验证
- 错误："它是否做X？"
- 正确："X是否明确指定？"